---
title: "Register your hook"
weight: 470
---

For you to use your hook with CloudFormation, you first need to submit it to the registry as a private extension. You can, subsequently, also choose to make your hook public, but we'll not cover this in this lab.

When you submit a hook to the registry, you register the hook in a given AWS account and region: if you need to make the hook available in another account or region, you'll need to make a separate submission to the registry for that. Alternatively, you can use [AWS CloudFormation StackSets](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/what-is-cfnstacksets.html) to submit the hook across regions and accounts by using a CloudFormation template where you describe, with code, the intent of submitting the hook to the registry using [CloudFormation resource types](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_CloudFormation.html) such as `AWS::CloudFormation::HookVersion`, `AWS::CloudFormation::HookDefaultVersion`, and `AWS::CloudFormation::HookTypeConfig`. In this lab, you'll use the CloudFormation CLI to submit your hook to the registry for a given region.

To submit your hook to the `us-east-1` region with the CloudFormation CLI, use the following command from the `example-hook/` directory:

:::code{language=shell showLineNumbers=false showCopyAction=true}
cfn submit --set-default --region us-east-1
:::

At the end of the process, you should get a message indicating that version `00000001` of your hook has been registered, and set as the default version.

When you use the CloudFormation CLI with the `cfn submit` command above to submit extensions to the CloudFormation registry (hooks, resource types, and modules), it'll create or update a CloudFormation stack in your account and for the region you're using, so to manage on your behalf a number of resources needed to submit an extension to the registry. This stack is called `CloudFormationManagedUploadInfrastructure`. Moreover, when you work with hooks or with resource types, the CloudFormation CLI also creates or updates another stack, whose name prefix is derived from the extension's name (in your case, the name of the stack will be `examplecompany-s3-versioningenabled-role-stack`), to create or update the execution role for the extension by using the CloudFormation template generated by the CloudFormation CLI (in your case, `hook-role.yaml`) that you've learned about earlier on this lab.

As this is the first time that you're submitting the hook to the registry, as the hook administrator persona you'll need to configure the hook after you submitted it to the registry. You can also configure the hook any time you need, should its configuration settings require an update to reflect your needs in the future.

Let's configure the hook! Create, inside the `example-hook/` directory, a file called `typeConfiguration.json` (like the one you created in your `.cfn-cli/` directory earlier):

:::code{language=shell showLineNumbers=false showCopyAction=true}
touch typeConfiguration.json
:::

Next, open the `typeConfiguration.json` file you just created inside the `example-hook/` directory, and add the following content to it:

:::code{language=json showLineNumbers=false showCopyAction=true}
{
    "CloudFormationConfiguration": {
        "HookConfiguration": {
            "TargetStacks": "ALL",
            "FailureMode": "FAIL",
            "Properties": {
                "IgnoreS3BucketNames": "example-ignored-bucket,example-ignored-bucket1"
            }
        }
    }
}
:::

::alert[In the example above, you've used `FAIL` for `FailureMode`. This is because as part of your requirements -and as part of how you'd want a hook to typically work- you want to treat compliance failures as errors that will prevent a given operation (such as, create, update, or delete) to run. If you wish to just simply emit a warning that will non prevent the provisioning of a non-compliant resource, use `WARN` instead of `FAIL`; you might only want to use `WARN` for limited use cases, such as -for example- to avoid preventing the provisioning of valid workloads in your sandbox account as you develop and test your hook with CloudFormation stacks, or if you want to give your account users a compliance deadline before you'll turn the setting to `FAIL`.]{type="warning"}

Next, you'll use the [AWS Command Line Interface](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/index.html) (and not the CloudFormation CLI in this case) to set the type configuration for your hook. First, you'll get the [Amazon Resource Name (ARN)](https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html) for your hook:

:::code{language=shell showLineNumbers=false showCopyAction=true}
aws cloudformation list-types \
  --type HOOK \
  --filters TypeNamePrefix=ExampleCompany::S3::VersioningEnabled \
  --query 'TypeSummaries[?TypeName==`ExampleCompany::S3::VersioningEnabled`].TypeArn' \
  --output text
:::

The command above should have returned the ARN of your hook, that uses the following format: `arn:aws:cloudformation:us-east-1:YOUR_ACCOUNT_ID:type/hook/ExampleCompany-S3-VersioningEnabled`; use this ARN to set up the type configuration as follows, by replacing `THE_ARN_OF_YOUR_HOOK` with the ARN you just retrieved:

:::code{language=shell showLineNumbers=false showCopyAction=true}
aws cloudformation set-type-configuration \
  --configuration file://typeConfiguration.json \
  --type-arn 'THE_ARN_OF_YOUR_HOOK'
:::

At the end of the process, you should get `ConfigurationArn` as the output, indicating information for the type configuration you've just set.

Congratulations! You just submitted to the registry, and configured your hook as the hook administrator persona! This concludes the first of the two workflows you learned about at the beginning of this lab. Are you ready to test the hook with CloudFormation, and see what you users would see in a variety of scenarios you'll test?

Choose **Next** to continue!
